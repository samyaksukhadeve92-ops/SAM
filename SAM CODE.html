<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Attendance System Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 320px;
            }
        }
        /* Custom Scrollbar for Log */
        .log-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .log-scroll::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .log-scroll::-webkit-scrollbar-thumb {
            background: #d6d3d1; 
            border-radius: 4px;
        }
        .log-scroll::-webkit-scrollbar-thumb:hover {
            background: #a8a29e; 
        }
    </style>
    <!-- Chosen Palette: Warm Administrative (Stone/White/Emerald/Rose) -->
    <!-- Application Structure Plan: 
         1. Header & Controls: Allows setting the context (Which class is active?) matching the python script's configuration.
         2. KPI Cards: Immediate quantitative feedback (Total, Present, Absent).
         3. Interaction Zone (The Simulator): A two-column layout. Left side acts as the "Input Device" (simulating facial/RFID scans). Right side acts as the "System Console" (displaying the logs generated by the Python script logic).
         4. Visual Analytics: A chart section to visualize the data distribution.
         5. Detailed Roster: A tabular view of the database state, updating in real-time.
         Why: This mimics the flow of the backend script (Input -> Process -> Log -> Store) but visualizes it for a non-technical user.
    -->
    <!-- Visualization & Content Choices: 
         1. Attendance Stats -> Goal: Inform -> Viz: KPI Cards + Donut Chart -> Interaction: Dynamic updates -> Justification: Immediate status check required for attendance systems. Chart.js used.
         2. Live System Log -> Goal: Change/Track -> Viz: Scrolling Terminal List -> Interaction: Appends new items on event -> Justification: Replaces the print statements from the source code.
         3. Student Simulation Pad -> Goal: Interaction -> Viz: Grid of Clickable Student Cards -> Interaction: Triggers check-in logic -> Justification: Replaces manual code execution/argument passing.
         4. Class Roster -> Goal: Organize -> Viz: Sortable HTML Table -> Interaction: Status badges update -> Justification: Replaces the final text report generation.
         Confirming NO SVG graphics used. NO Mermaid JS used.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-stone-100 text-stone-800 min-h-screen flex flex-col">

    <!-- Navbar -->
    <header class="bg-white shadow-sm border-b border-stone-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <span class="text-2xl">üéì</span>
                <h1 class="text-xl font-bold text-stone-900 tracking-tight">Smart Attendance <span class="text-stone-500 font-normal">Dashboard</span></h1>
            </div>
            <div class="flex items-center gap-4">
                <div class="hidden md:flex items-center text-sm text-stone-500 bg-stone-50 px-3 py-1 rounded-full border border-stone-200">
                    <span class="mr-2">üìÖ</span>
                    <span id="current-date"></span>
                </div>
                <button onclick="resetSystem()" class="text-sm text-rose-600 hover:text-rose-700 font-medium px-3 py-1 hover:bg-rose-50 rounded transition-colors">
                    Reset Session
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">

        <!-- Intro Section -->
        <section>
            <div class="max-w-3xl">
                <h2 class="text-2xl font-semibold text-stone-900 mb-2">System Overview & Configuration</h2>
                <p class="text-stone-600 leading-relaxed">
                    This dashboard simulates the backend logic of the Python Attendance System. It manages a student database and processes "check-in" events in real-time. 
                    Currently monitoring <span class="font-bold text-indigo-600">Class 10-A</span>. Use the controls below to simulate students scanning their ID cards or facing the camera.
                </p>
            </div>
        </section>

        <!-- KPI Grid -->
        <section class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                <div class="text-sm font-medium text-stone-500 mb-1">Expected Students</div>
                <div class="text-3xl font-bold text-stone-900" id="kpi-total">0</div>
                <div class="text-xs text-stone-400 mt-2">Class 10-A Roster</div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 border-l-4 border-l-emerald-500">
                <div class="text-sm font-medium text-stone-500 mb-1">Present</div>
                <div class="text-3xl font-bold text-emerald-600" id="kpi-present">0</div>
                <div class="text-xs text-stone-400 mt-2">Checked In Successfully</div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 border-l-4 border-l-rose-500">
                <div class="text-sm font-medium text-stone-500 mb-1">Absent</div>
                <div class="text-3xl font-bold text-rose-600" id="kpi-absent">0</div>
                <div class="text-xs text-stone-400 mt-2">Pending Check-ins</div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                <div class="text-sm font-medium text-stone-500 mb-1">Attendance Rate</div>
                <div class="text-3xl font-bold text-indigo-600" id="kpi-rate">0%</div>
                <div class="text-xs text-stone-400 mt-2">Real-time Calculation</div>
            </div>
        </section>

        <!-- Interaction & Logs Section -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left: Simulation Controls -->
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden">
                    <div class="px-6 py-4 border-b border-stone-100 flex justify-between items-center bg-stone-50">
                        <h3 class="font-semibold text-stone-800">Check-In Simulator</h3>
                        <span class="text-xs font-mono bg-stone-200 text-stone-600 px-2 py-1 rounded">Mode: Manual Input</span>
                    </div>
                    
                    <div class="p-6">
                        <p class="text-sm text-stone-500 mb-4">
                            Click a student card below to simulate a "Face Recognition" or "ID Scan" event. 
                            Watch how the system handles valid students, wrong classes, and duplicates.
                        </p>

                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 mb-6" id="student-buttons">
                            <!-- Buttons generated by JS -->
                        </div>

                        <div class="pt-4 border-t border-stone-100">
                            <label class="block text-xs font-medium text-stone-500 uppercase tracking-wider mb-2">Test Unknown ID</label>
                            <div class="flex gap-2">
                                <input type="text" id="manual-id-input" placeholder="Enter ID (e.g. S999)" class="flex-1 rounded-md border-stone-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border px-3 py-2">
                                <button onclick="handleManualCheckIn()" class="bg-stone-800 text-white px-4 py-2 rounded-md hover:bg-stone-700 transition-colors text-sm font-medium">
                                    Simulate Scan
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visualization Container -->
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                    <h3 class="font-semibold text-stone-800 mb-4">Real-Time Distribution</h3>
                    <div class="chart-container">
                        <canvas id="attendanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Right: Live Logs -->
            <div class="lg:col-span-1">
                <div class="bg-stone-900 rounded-xl shadow-lg border border-stone-800 overflow-hidden h-full flex flex-col">
                    <div class="px-4 py-3 border-b border-stone-700 bg-stone-800 flex justify-between items-center">
                        <span class="text-stone-300 font-mono text-sm">System Terminal</span>
                        <div class="flex gap-1.5">
                            <div class="w-3 h-3 rounded-full bg-rose-500"></div>
                            <div class="w-3 h-3 rounded-full bg-amber-500"></div>
                            <div class="w-3 h-3 rounded-full bg-emerald-500"></div>
                        </div>
                    </div>
                    <div class="p-4 font-mono text-xs md:text-sm overflow-y-auto h-[500px] log-scroll bg-stone-900" id="system-log">
                        <!-- Logs go here -->
                        <div class="text-stone-500 mb-2">// System initialized...</div>
                        <div class="text-stone-500 mb-2">// Waiting for input events...</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Detailed Roster -->
        <section class="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden mb-8">
            <div class="px-6 py-5 border-b border-stone-100">
                <h3 class="font-semibold text-stone-800">Class 10-A Roster & Status</h3>
                <p class="text-sm text-stone-500 mt-1">Updates automatically. Matches "generate_report" output.</p>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-stone-200">
                    <thead class="bg-stone-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Student ID</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Name</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Class</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Status</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Check-in Time</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-stone-200" id="roster-body">
                        <!-- Table rows generated by JS -->
                    </tbody>
                </table>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-stone-200 py-8 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-stone-400 text-sm">Smart Attendance System Mockup ‚Ä¢ Generated based on Python Simulation Logic</p>
        </div>
    </footer>

    <script>
        // --- 1. Data Initialization (Mirroring Python Dictionary) ---
        
        const STUDENT_DATABASE = {
            "S001": { name: "Alice Johnson", class: "10-A", avatar: "üë©üèª‚Äçüéì" },
            "S002": { name: "Bob Smith", class: "10-A", avatar: "üë®üèº‚Äçüéì" },
            "S003": { name: "Charlie Brown", class: "10-B", avatar: "üë®üèΩ‚Äçüéì" }, // Wrong class
            "S004": { name: "Diana Prince", class: "10-A", avatar: "üë©üèæ‚Äçüéì" },
            "S005": { name: "Eve Adams", class: "10-A", avatar: "üë©üèº‚Äçüéì" },
            "S006": { name: "Frank Miller", class: "10-B", avatar: "üë®üèª‚Äçüéì" }, // Wrong class
            "S007": { name: "George Weasley", class: "10-A", avatar: "üë®üèª‚Äçü¶∞" } // Extra student
        };

        // App Configuration
        const CLASS_TO_TRACK = "10-A";
        let attendanceRecords = {}; // Stores Check-in Time and Status
        
        // --- 2. Core Logic (Translating Python Functions) ---

        function getTimestamp() {
            const now = new Date();
            return now.toLocaleTimeString('en-US', { hour12: false });
        }

        function logToTerminal(message, type = 'info') {
            const logContainer = document.getElementById('system-log');
            const entry = document.createElement('div');
            entry.className = "mb-1.5 font-mono text-xs md:text-sm animate-fade-in";
            
            const timestamp = `<span class="text-stone-500">[${getTimestamp()}]</span>`;
            
            let content = "";
            if (type === 'success') {
                content = `${timestamp} <span class="text-emerald-400">‚úÖ ${message}</span>`;
            } else if (type === 'error') {
                content = `${timestamp} <span class="text-rose-400">‚ùå ${message}</span>`;
            } else if (type === 'warning') {
                content = `${timestamp} <span class="text-amber-400">‚ö†Ô∏è ${message}</span>`;
            } else {
                content = `${timestamp} <span class="text-stone-300">‚ÑπÔ∏è ${message}</span>`;
            }
            
            entry.innerHTML = content;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function recordAttendance(studentId) {
            const student = STUDENT_DATABASE[studentId];

            // 1. Check if ID exists
            if (!student) {
                logToTerminal(`Error: Student ID **${studentId}** not found in database.`, 'error');
                return;
            }

            // 2. Check Class Validity
            if (student.class !== CLASS_TO_TRACK) {
                logToTerminal(`Access Denied: ${student.name} (${studentId}) is in class ${student.class}, not ${CLASS_TO_TRACK}.`, 'warning');
                return;
            }

            // 3. Check for Duplicate
            if (attendanceRecords[studentId]) {
                const prevTime = attendanceRecords[studentId].timeIn;
                logToTerminal(`Info: ${student.name} already marked Present at ${prevTime}.`, 'info');
                return;
            }

            // 4. Success Case
            const timeIn = getTimestamp();
            attendanceRecords[studentId] = {
                status: 'Present',
                timeIn: timeIn
            };
            
            logToTerminal(`Recorded: ${student.name} (${studentId}) marked Present.`, 'success');
            
            // Update UI
            updateDashboard();
        }

        // --- 3. UI & Visualization Updates ---

        let donutChart = null;

        function initChart() {
            const ctx = document.getElementById('attendanceChart').getContext('2d');
            donutChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Present', 'Absent'],
                    datasets: [{
                        data: [0, 1],
                        backgroundColor: ['#10b981', '#f43f5e'], // Emerald-500, Rose-500
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { family: "'Inter', sans-serif" },
                                color: '#44403c'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${context.label}: ${context.raw} Students`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateDashboard() {
            // Get all students meant for this class
            const expectedStudents = Object.entries(STUDENT_DATABASE)
                .filter(([id, s]) => s.class === CLASS_TO_TRACK);
            
            const totalCount = expectedStudents.length;
            const presentCount = Object.keys(attendanceRecords).length;
            const absentCount = totalCount - presentCount;
            const rate = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;

            // Update KPI Cards
            document.getElementById('kpi-total').textContent = totalCount;
            document.getElementById('kpi-present').textContent = presentCount;
            document.getElementById('kpi-absent').textContent = absentCount;
            document.getElementById('kpi-rate').textContent = `${rate}%`;

            // Update Chart
            if (donutChart) {
                donutChart.data.datasets[0].data = [presentCount, absentCount];
                donutChart.update();
            }

            // Update Roster Table
            renderRoster(expectedStudents);
        }

        function renderRoster(expectedStudents) {
            const tbody = document.getElementById('roster-body');
            tbody.innerHTML = '';

            expectedStudents.forEach(([id, student]) => {
                const record = attendanceRecords[id];
                const isPresent = !!record;
                
                const tr = document.createElement('tr');
                tr.className = isPresent ? 'bg-emerald-50/50' : '';
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-stone-900 font-mono">${id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-stone-700 flex items-center gap-2">
                        <span>${student.avatar}</span> ${student.name}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-stone-500">${student.class}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${isPresent ? 'bg-emerald-100 text-emerald-800' : 'bg-rose-100 text-rose-800'}">
                            ${isPresent ? 'Present' : 'Absent'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-stone-500 font-mono">
                        ${isPresent ? record.timeIn : '--:--:--'}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderStudentButtons() {
            const container = document.getElementById('student-buttons');
            container.innerHTML = '';

            Object.entries(STUDENT_DATABASE).forEach(([id, student]) => {
                const btn = document.createElement('button');
                // Styling based on whether they belong to the correct class (visual cue for user testing)
                const isCorrectClass = student.class === CLASS_TO_TRACK;
                
                btn.className = `p-3 rounded-lg border text-left transition-all hover:shadow-md flex items-center gap-3
                    ${isCorrectClass ? 'bg-white border-stone-200 hover:border-indigo-300' : 'bg-stone-50 border-stone-200 opacity-75 hover:opacity-100 hover:border-amber-300'}`;
                
                btn.onclick = () => recordAttendance(id);
                
                btn.innerHTML = `
                    <div class="text-2xl">${student.avatar}</div>
                    <div>
                        <div class="text-sm font-semibold text-stone-800">${student.name}</div>
                        <div class="text-xs text-stone-500 font-mono">${id} ‚Ä¢ ${student.class}</div>
                    </div>
                `;
                container.appendChild(btn);
            });
        }

        function handleManualCheckIn() {
            const input = document.getElementById('manual-id-input');
            const val = input.value.trim().toUpperCase();
            if (val) {
                recordAttendance(val);
                input.value = '';
            }
        }

        function resetSystem() {
            attendanceRecords = {};
            document.getElementById('system-log').innerHTML = '<div class="text-stone-500 mb-2">// System reset. Waiting for input...</div>';
            updateDashboard();
            logToTerminal("Session reset by administrator.", "info");
        }

        // --- 4. Initialization ---

        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('current-date').textContent = new Date().toLocaleDateString();
            initChart();
            renderStudentButtons();
            updateDashboard(); // Initial render with 0 present
            
            // Simulate startup log
            setTimeout(() => logToTerminal(`System Active. Monitoring Class: ${CLASS_TO_TRACK}`), 500);
        });

    </script>
</body>
</html>